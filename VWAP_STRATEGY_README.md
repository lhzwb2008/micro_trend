# VWAP反向策略 - BTC日内均值回归交易系统

## 📊 策略概述

VWAP反向策略是一个基于均值回归理论的日内交易系统。当价格过度偏离VWAP（成交量加权平均价）时，进行反向交易，预期价格会回归到均值。

**核心逻辑：**
- 💰 价格显著高于VWAP → 做空（预期回落）
- 📈 价格显著低于VWAP → 做多（预期反弹）

## 🏆 回测表现（2020-2025年，5年数据）

### ⭐ 推荐配置：Balanced（平衡型）

| 指标 | 数值 |
|------|------|
| **总收益率** | +85.06% |
| **年化收益率** | +11.08% |
| **夏普比率** | 0.634 |
| **最大回撤** | -35.33% |
| **Calmar比率** | 0.314 |
| **总交易次数** | 130笔 |
| **胜率** | 56.92% |
| **盈利因子** | 1.45 |
| **平均持仓** | 73分钟 |

### 🚀 高收益配置：High Return

| 指标 | 数值 |
|------|------|
| **总收益率** | +131.50% |
| **年化收益率** | +15.41% |
| **夏普比率** | 0.927 |
| **最大回撤** | -33.10% |
| **胜率** | 67.27% |
| **盈利因子** | 2.55 |
| **总交易次数** | 55笔 |

### 📊 各配置对比

| 配置 | 偏离阈值 | 年化收益 | 夏普比率 | 最大回撤 | 交易次数 | 胜率 |
|------|----------|----------|----------|----------|----------|------|
| **Balanced** ⭐ | 8% | 11.08% | 0.634 | -35.33% | 130 | 56.92% |
| High Return | 10% | 15.41% | 0.927 | -33.10% | 55 | 67.27% |
| Moderate | 7% | 10.53% | 0.572 | -35.33% | 214 | 55.14% |
| Frequent | 6% | 4.28% | 0.294 | -35.49% | 378 | 51.98% |

## 💡 策略原理

### 1. VWAP计算

VWAP（Volume Weighted Average Price）= Σ(价格 × 成交量) / Σ(成交量)

```
典型价格 = (最高价 + 最低价 + 收盘价) / 3
VWAP = 滚动周期内(典型价格 × 成交量)之和 / 滚动周期内成交量之和
```

默认周期：96个15分钟K线 = 24小时

### 2. 偏离度计算

**偏离百分比** = (当前价格 - VWAP) / VWAP × 100%

### 3. 交易信号

- **做多信号**：价格偏离VWAP低于 -X%（如-8%）
- **做空信号**：价格偏离VWAP高于 +X%（如+8%）

### 4. 退出条件

1. **止盈**：达到目标盈利（如3%）
2. **止损**：达到最大亏损（如1.5%）
3. **VWAP回归**：价格回到VWAP附近（±0.3%）
4. **最大持仓时间**：超过设定周期（如12个15分钟）
5. **强制平仓**：每日23:45 UTC强制平仓

### 5. 风险控制

- ✅ 成交量确认：只在成交量高于均线时入场
- ✅ 固定止损：严格执行止损规则
- ✅ 时间退出：避免过夜风险
- ✅ 对称交易：多空平衡，适应不同市场环境

## 🚀 使用方法

### 1. 安装依赖

```bash
pip install pandas numpy
```

### 2. 下载数据

确保已有BTC 15分钟K线数据：

```bash
python3 download_btc_data.py
```

### 3. 运行回测

```bash
python3 vwap_reversal_strategy.py
```

### 4. 切换预设配置

编辑 `vwap_reversal_strategy.py` 文件：

```python
# 选择预设配置
ACTIVE_PRESET = 'balanced'  # 可选: 'balanced'⭐, 'high_return', 'moderate', 'frequent'
```

### 5. 自定义参数

也可以直接修改 `CONFIG` 字典：

```python
CONFIG = {
    # VWAP计算周期
    'vwap_period': 96,  # 96个15分钟 = 24小时
    
    # 使用固定百分比偏离
    'use_fixed_deviation': True,
    'entry_deviation_pct': 0.08,  # 8%偏离才入场
    
    # 止盈止损
    'take_profit_pct': 0.03,   # 3%止盈
    'stop_loss_pct': 0.015,    # 1.5%止损
    
    # 时间控制
    'max_hold_periods': 12,    # 最多持仓12个15分钟
    
    # VWAP回归退出
    'exit_on_vwap_touch': True,
    'vwap_touch_threshold': 0.003,  # 0.3%以内视为回归
    
    # 成交量确认
    'require_volume_confirm': True,
    'volume_threshold': 1.0,
}
```

## 📈 策略优势

### ✅ 均值回归特性

- 捕捉极端偏离后的回归机会
- 在震荡市场表现优异
- 风险收益比合理

### ✅ 参数灵活可调

- 4个预设配置满足不同需求
- 可自定义偏离阈值、止盈止损
- 可调整VWAP周期和持仓时间

### ✅ 风险控制完善

- 固定止损保护本金
- 时间退出避免过夜风险
- 成交量确认提高信号质量
- VWAP回归及时锁定利润

### ✅ 对称交易

- 可同时做多做空
- 适应牛市和熊市
- 多空胜率均衡

## ⚠️ 风险提示

### 1. 市场风险

- **强趋势市场**：在单边强趋势中，价格可能持续偏离VWAP而不回归，导致连续止损
- **黑天鹅事件**：极端市场波动可能导致滑点扩大，实际表现不如回测

### 2. 回撤风险

- 最大回撤约35%，需要充足的风险承受能力
- 建议仓位不超过总资金的50%

### 3. 交易成本

- 回测假设手续费0.1%和滑点0.05%
- 实盘交易需考虑更高的成本（特别是高频配置）

### 4. 实盘差异

- 回测基于历史数据，不代表未来表现
- 实盘需考虑：网络延迟、API限制、订单延迟等因素

## 🎯 配置选择建议

### Balanced（推荐新手）⭐

- **适合人群**：寻求稳健收益，希望有适中交易频率
- **特点**：收益与回撤平衡，交易次数130笔/5年
- **预期**：年化11%，夏普0.634

### High Return（推荐进阶）

- **适合人群**：追求更高收益，能接受较少交易机会
- **特点**：高胜率（67%），高盈利因子（2.55）
- **预期**：年化15%，夏普0.927
- **注意**：交易次数少（55笔/5年），需要耐心等待

### Moderate（中庸之选）

- **适合人群**：希望有更多交易机会，但不要太频繁
- **特点**：交易频率适中（214笔/5年）
- **预期**：年化10.5%

### Frequent（高频交易）

- **适合人群**：喜欢频繁交易，追求资金高周转
- **特点**：交易机会多（378笔/5年），但单笔利润较小
- **预期**：年化4.3%
- **注意**：手续费影响较大，需要超低费率交易所

## 🔧 优化建议

### 1. 降低回撤

- 减小仓位至50%
- 收紧止损（如降到1%）
- 提高偏离阈值（如9-10%）

### 2. 提高收益

- 增加仓位（风险也增加）
- 放宽止盈目标
- 使用杠杆（谨慎！）

### 3. 改善胜率

- 增加趋势过滤（如200日均线）
- 结合RSI等超买超卖指标
- 优化VWAP周期

### 4. 适应市场

- 牛市：可偏重做多
- 熊市：可偏重做空
- 震荡市：保持对称

## 📊 性能对比

| 策略 | 年化收益 | 夏普比率 | 最大回撤 | 特点 |
|------|----------|----------|----------|------|
| VWAP反向（Balanced） | 11.08% | 0.634 | -35.33% | 均值回归，适合震荡 |
| VWAP反向（High Return） | 15.41% | 0.927 | -33.10% | 高胜率，高盈利因子 |
| Dual Thrust | 25.47% | 0.533 | -52.64% | 趋势跟随，适合趋势 |

**结论**：
- VWAP反向策略回撤更小，更稳健
- Dual Thrust收益更高，但回撤更大
- 两者可以组合使用，互补优势

## 📝 策略特点总结

### ✅ 优点

1. **回撤可控**：最大回撤约33-35%，远低于Dual Thrust的52%
2. **夏普比率高**：High Return配置夏普比率达0.927
3. **胜率高**：High Return配置胜率达67%
4. **逻辑清晰**：基于均值回归，易于理解
5. **参数少**：主要参数只有偏离阈值、止盈止损

### ⚠️ 缺点

1. **收益相对较低**：年化收益低于趋势跟随策略
2. **依赖震荡**：在强单边趋势中表现不佳
3. **交易频率**：部分配置交易机会较少

## 📧 联系方式

如有问题或建议，欢迎提Issue。

---

**免责声明**：本策略仅供学习和研究使用，不构成任何投资建议。加密货币交易风险极高，请谨慎投资，风险自负。

